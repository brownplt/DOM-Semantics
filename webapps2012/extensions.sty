% Ensure loading a single time only
\csname ifextensionsstyloaded\endcsname
\let\ifextensionsstyloaded\endinput

% Declare ourselves to LaTeX
\expandafter\ifx\csname ProvidesPackage\endcsname\relax\else
  \ProvidesPackage{extensions}
    [2009/09/17 v0.1 Provides styles for typesetting
    extensions-related code (HTML markup, mostly)]
\fi

% \usepackage{subfigure}
% \newbox\subfigbox
% \newenvironment{subfloat}
% {\def\caption##1{\gdef\subcapsave{\relax##1}}%
% \let\subcapsave\@empty
% \setbox\subfigbox\hbox
% \bgroup}
% {\egroup
% \subfigure[\subcapsave]{\box\subfigbox}}


\usepackage{ifthen,tabularx}
\usepackage{mathtools}
\newsavebox{\fmbox}
\newenvironment{fmpage}[2][c]
  {\begin{lrbox}{\fmbox}\begin{minipage}[#1]{#2}}
  {\end{minipage}\end{lrbox}\fbox{\usebox{\fmbox}}}
\newenvironment{framed}[1][\fboxsep=0pt\framebox]
{\def\frameh@@k{#1}\fboxsep=0pt\begin{lrbox}{\fmbox}}
{\end{lrbox}\frameh@@k{\usebox{\fmbox}}}

\def\underbracket{\@ifnextchar [ {\@underbracket} {\@underbracket [\@bracketheight]}}
\def\@underbracket[#1]{\@ifnextchar [ {\@under@bracket[#1]} {\@under@bracket[#1][0.4em]}}
\def\@under@bracket[#1][#2]#3{%\message {Underbracket: #1,#2,#3}
           \mathop {\vtop {\m@th \ialign {##\crcr $\hfil \displaystyle {#3}\hfil $%
                              \crcr \noalign {\kern 3\p@ \nointerlineskip }\upbracketfill {#1}{#2}
                              \crcr \noalign {\kern 3\p@ }}}}\limits}
\def\upbracketfill#1#2{$\m@th \setbox \z@ \hbox {$\braceld$}
                  \edef\@bracketheight{\the\ht\z@}\bracketend{#1}{#2}
                  \leaders \vrule \@height #1 \@depth \z@ \hfill 
                  \leaders \vrule \@height #1 \@depth \z@ \hfill \bracketend{#1}{#2}$}
\def\bracketend#1#2{\vrule height #2 width #1\relax}


\def\overbracket{\@ifnextchar [ {\@overbracket} {\@overbracket
[\@bracketheight]}}
\def\@overbracket[#1]{\@ifnextchar [ {\@over@bracket[#1]}
{\@over@bracket[#1][0.3em]}}
\def\@over@bracket[#1][#2]#3{%\message {Overbracket: #1,#2,#3}
\mathop {\vbox {\m@th \ialign {##\crcr \noalign {\kern 3\p@
\nointerlineskip }\downbracketfill {#1}{#2}
                              \crcr \noalign {\kern 3\p@ }
                              \crcr  $\hfil \displaystyle {#3}\hfil $%
                              \crcr} }}\limits}
\def\downbracketfill#1#2{$\m@th \setbox \z@ \hbox {$\braceld$}
                  \edef\@bracketheight{\the\ht\z@}\downbracketend{#1}{#2}
                  \leaders \vrule \@height #1 \@depth \z@ \hfill
                  \leaders \vrule \@height #1 \@depth \z@ \hfill
\downbracketend{#1}{#2}$}
\def\downbracketend#1#2{\vrule depth #2 width #1\relax}


\newenvironment{langdefn}[1][]
  {\ifthenelse{\equal{#1}{}}{}{\textbf{#1} \\ }\ensuremath{\overbracket{\hspace{\textwidth}}}}
  {\ensuremath{\underbracket{\hspace{\textwidth}}}\vspace*{2pt}}
\newenvironment{langdefn*}[1][]
  {\noindent\ignorespaces\ifthenelse{\equal{#1}{}}{}{\textbf{#1} \\ }\rlap{\ensuremath{\overbracket{\hspace{\columnwidth}}}}\vspace*{-\baselineskip}\par\noindent}
  {\ensuremath{\underbracket{\hspace{\columnwidth}}}}
\newcolumntype{C}{>{$}c<{$}}
\newcolumntype{L}{>{$}l<{$}}
\newcolumntype{R}{>{$}r<{$}}
\newcolumntype{x}{>{$}X<{$}}
\newenvironment{syntax}
{\noindent\ignorespaces\setlength{\extrarowheight}{2pt}\tabularx{\textwidth}{@{\ }R@{\ }C@{\ }>{\sc}r@{\ \ }C@{\ \ }x@{}>{--\it}l@{}}}
{\endtabularx}
\newenvironment{syntax*}[1][\columnwidth]
{\setlength{\extrarowheight}{2pt}\tabularx{#1}{@{\ }R@{\ }C@{\ }>{\sc}r@{\ \ }C@{\ \ }x@{}>{--\it}l@{}}}
{\endtabularx}
\DeclareMathOperator{\bnf|}{{\ \big|\ }}
\providecommand\ceqq{\Coloneqq}


\DeclareRobustCommand{\tagname}[1]{\nolinebreak[4]\textbf{#1}}
\DeclareRobustCommand{\attrname}[1]{#1}
\DeclareRobustCommand{\xattrname}[1]{\attrname{@#1}}
\DeclareRobustCommand{\etag}[2]{% <foo attrs />
  \begingroup%
  %\def\a{#1}\def\b{#2}%
  \ensuremath{\langle}\tagname{#1}%
  \ifthenelse{\equal{#2}{}}{}{~#2}%
  \ensuremath{/\rangle}%
  \endgroup%
}
\DeclareRobustCommand{\ftag}[3]{% <foo attrs>body</foo>
  \begingroup%\def\a{#1}\def\b{#2}\def\c{#3}%
  \ensuremath{\langle}\tagname{#1}%
  \ifthenelse{\equal{#2}{}}{}{~#2}%
  \ensuremath{\rangle}\nopagebreak\linebreak[0]%
  \begingroup#3\endgroup\nopagebreak\linebreak[0]%
  \ensuremath{\langle/\tagname{#1}\rangle}%
  \endgroup%
}
\newlength{\localhangindent}
\newlength{\initialleftskip}
\newlength{\localparindent}
\newenvironment{xtag}[2][]{%
  \begingroup%
  \def\a{#2}\def\b{#1}%
  \ifthenelse{\equal{\b}{no-close}}{\let\noClose\b\def\b{}}{\def\noClose{}}%
  \setlength{\localhangindent}{\parindent}%
  \addtolength{\localhangindent}{1.5em}%
  \setlength{\localparindent}{\parindent}%
  \begin{sloppypar}\hangindent=\localhangindent\hangafter=1\rightskip=0pt plus3em%
    \ifthenelse{\equal{\noClose}{no-close}}{%
      \textit{\a}%
    }{%
      \ensuremath{\langle}\tagname{\a}%
      \ifthenelse{\equal{\b}{}}{}{~\b}%
      \ensuremath{\rangle}%
    }%
  \end{sloppypar}%
  \addtolength{\parindent}{1em}\par%
}{%
  \addtolength{\parindent}{-1em}%
  \ifthenelse{\equal{\noClose}{no-close}}{}{\par%
    \ensuremath{\langle}/\tagname{\a}\ensuremath{\rangle}}%
  \endgroup%
}

\DeclareRobustCommand{\attr}[2]{\attrname{#1}=``#2''}
\DeclareRobustCommand{\xattr}[2]{\xattrname{#1}=``#2''}
\DeclareRobustCommand{\where}[1]{\ensuremath{\lbrack}#1\ensuremath{\rbrack}\nopagebreak\linebreak[0]}
\DeclareRobustCommand{\stag}[1]{\etag{#1}{}}
\DeclareRobustCommand{\etagid}[2]{\etag{#1}{\attr{id}{#2}}}
\newcommand{\bs}{\textbackslash}
